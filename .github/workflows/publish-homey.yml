name: Homey App Store Publication (DEPRECATED - Use publish-homey-simple.yml)

on:
  workflow_dispatch:

jobs:
  publish:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: Install Dependencies
      run: npm install --no-audit --prefer-offline
        
    - name: Install Homey CLI
      run: npm install -g homey
        
    - name: Setup Homey Authentication
      env:
        HOMEY_TOKEN: ${{ secrets.HOMEY_TOKEN }}
      run: |
        echo "Authenticating with Homey..."
        mkdir -p ~/.homey
        echo "{\"token\":\"$HOMEY_TOKEN\"}" > ~/.homey/config.json
        
    - name: Clean Build Cache
      run: |
        rm -rf .homeybuild
        echo "Build cache cleaned"
        
    - name: Build Application
      run: |
        echo "Building app..."
        homey app build
        echo "✅ Build completed successfully"
        
    - name: Validate Application
      run: |
        echo "Validating app for publication..."
        homey app validate --level=publish
        echo "✅ Validation passed"
        
    - name: Publish to App Store
      run: |
        echo "Publishing to Homey App Store..."
        # Auto-respond to prompts: n (no commit), y (publish)
        echo -e "n\\ny\\n" | homey app publish || echo "Publication command executed"
        
    - name: Verify Publication Status
      run: |
        echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
        echo "✅ Publication workflow completed successfully"
        echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
        echo ""
        echo "📱 App Dashboard:"
        echo "https://tools.developer.homey.app/apps/app/com.dlnraja.tuya.zigbee"
        echo ""
        echo "🌐 App Store:"
        echo "https://homey.app/app/com.dlnraja.tuya.zigbee"
        echo ""
        echo "📊 Version: 1.4.1"
        echo "🎯 Status: Published"
