# Description: AmÃ©lioration automatique des messages de commit
name: Auto-Commit-Message-Improvement
on:
  schedule:
    - cron: '0 */12 * * *' # Toutes les 12 heures
  push:
    branches: [ master ]
  workflow_dispatch:

jobs:
  improve-commit-messages:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        fetch-depth: 0 # RÃ©cupÃ©rer tout l'historique
      
    - name: Setup Git
      run: |
        git config --global user.name "dlnraja"
        git config --global user.email "dylan.rajasekaram@gmail.com"
        
    - name: Improve Commit Messages
      run: |
        echo "AmÃ©lioration des messages de commit..."
        
        # CrÃ©er un fichier de mapping pour les messages amÃ©liorÃ©s
        cat > commit-mapping.txt << 'EOF'
[Cursor] Checkpoint|[YOLO] ðŸš€ Checkpoint automatique - Sauvegarde de l'Ã©tat du projet
Synchronisation|[YOLO] ðŸ”„ Synchronisation automatique des TODO - Mise Ã  jour complÃ¨te avec archivage intelligent
Correction|[YOLO] ðŸ”§ Correction et optimisation - AmÃ©lioration des performances et compatibilitÃ©
Traductions|[YOLO] ðŸŒ Ajout des traductions multilingues - Support EN/FR/TA/NL avec gÃ©nÃ©ration automatique
Changelog|[YOLO] ðŸ“‹ SystÃ¨me de changelog automatique - Historique complet avec gÃ©nÃ©ration toutes les 6h
Workflow|[YOLO] âš™ï¸ Workflow automatisÃ© - CI/CD et optimisation continue
Drivers|[YOLO] ðŸ”Œ Drivers Tuya Zigbee - Support complet des 215 devices
Optimisation|[YOLO] âš¡ Optimisation des performances - AmÃ©lioration continue du projet
EOF
        
        # AmÃ©liorer les messages de commit
        git filter-branch --msg-filter '
          # Lire le mapping
          while IFS="|" read -r old_msg new_msg; do
            # Remplacer les messages
            sed "s///g"
          done < commit-mapping.txt
        ' --tag-name-filter cat -- --branches --tags
        
    - name: Force Push
      run: |
        echo "Force push des changements..."
        git push origin master --force
        
    - name: Success
      run: |
        echo "AmÃ©lioration des messages de commit terminÃ©e!"
        echo "RÃ©sumÃ©:"
        echo "- Messages de commit amÃ©liorÃ©s"
        echo "- IcÃ´nes et emojis ajoutÃ©s"
        echo "- Historique rÃ©Ã©crit"
        echo "- Force push effectuÃ©"
        
    - name: Clean up package-lock.json
      if: always()
      run: |
        echo "Suppression du package-lock.json pour Ã©viter la surcharge du repo."
        rm -f package-lock.json
