name: ðŸ“š Auto-Update Docs
"on":
  workflow_run:
    workflows:
      - ðŸš€ Auto-Publish on Push
    types:
      - completed
  workflow_dispatch:
    inputs:
      force:
        description: Force update even if no changes
        required: false
        default: "false"
permissions:
  contents: write
  actions: read
env:
  NODE_VERSION: "20"
jobs:
  update-docs:
    name: ðŸ“š Update Documentation
    runs-on: ubuntu-latest
    if: always()
    steps:
      - name: ðŸ“¥ Checkout
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: ðŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: npm
      - name: ðŸ“Š Get App Info
        id: info
        run: |
          VERSION=$(node -p "require('./app.json').version")
          DRIVERS=$(node -p "require('./app.json').drivers.length")
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "drivers=$DRIVERS" >> $GITHUB_OUTPUT
          echo "ðŸ“¦ Version: $VERSION | Drivers: $DRIVERS"
      - name: ðŸ“š Update Documentation
        run: |
          echo "ðŸ”„ Running AUTO_UPDATE_ALL_DOCS.js..."
          node scripts/automation/AUTO_UPDATE_ALL_DOCS.js
      - name: ðŸ“ Check for Changes
        id: changes
        run: |
          if git diff --quiet README.md docs/device-finder.html 2>/dev/null; then
            echo "has_changes=false" >> $GITHUB_OUTPUT
            echo "â„¹ï¸ No documentation changes detected"
          else
            echo "has_changes=true" >> $GITHUB_OUTPUT
            echo "âœ… Documentation changes detected"
            git diff --stat README.md docs/device-finder.html
          fi
      - name: ðŸš€ Commit & Push
        if: steps.changes.outputs.has_changes == 'true'
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md docs/device-finder.html
          git commit -m "ðŸ“š Auto-update docs"
          git push
      - name: âœ… Summary
        run: |
          echo "## ðŸ“š Documentation Update" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Version:** v"automated"" >> $GITHUB_STEP_SUMMARY
          echo "**Drivers:** "automated"" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          if [ ""automated"" == "true" ]; then
            echo "âœ… **Documentation updated and pushed!**" >> $GITHUB_STEP_SUMMARY
          else
            echo "â„¹ï¸ **No changes needed**" >> $GITHUB_STEP_SUMMARY
          fi
    timeout-minutes: 20
    strategy:
      fail-fast: true
      matrix:
        node-version:
          - 18
