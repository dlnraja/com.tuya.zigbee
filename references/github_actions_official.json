{
  "metadata": {
    "created": "2025-10-11",
    "author": "Dylan Rajasekaram",
    "documentation": "https://apps.developer.homey.app/app-store/publishing",
    "version": "1.0.0"
  },
  "official_actions": {
    "validate": {
      "name": "Homey App Validate",
      "marketplace_url": "https://github.com/marketplace/actions/homey-app-validate",
      "repository": "athombv/github-action-homey-app-validate",
      "usage": "athombv/github-action-homey-app-validate@master",
      "inputs": {
        "validate-level": {
          "description": "Validation level",
          "required": false,
          "default": "publish",
          "options": ["debug", "publish", "verified"]
        }
      },
      "outputs": {},
      "example": "uses: athombv/github-action-homey-app-validate@master\nwith:\n  validate-level: publish"
    },
    "update_version": {
      "name": "Homey App Update Version",
      "marketplace_url": "https://github.com/marketplace/actions/homey-app-update-version",
      "repository": "athombv/github-action-homey-app-update-version",
      "usage": "athombv/github-action-homey-app-update-version@master",
      "inputs": {
        "version": {
          "description": "Version increment type",
          "required": true,
          "options": ["patch", "minor", "major"]
        },
        "changelog": {
          "description": "Changelog message (max 400 chars)",
          "required": false,
          "default": "Bug fixes and improvements"
        }
      },
      "outputs": {
        "version": {
          "description": "New version number"
        }
      },
      "example": "uses: athombv/github-action-homey-app-update-version@master\nwith:\n  version: patch\n  changelog: 'Added support for new devices'"
    },
    "publish": {
      "name": "Homey App Publish",
      "marketplace_url": "https://github.com/marketplace/actions/homey-app-publish",
      "repository": "athombv/github-action-homey-app-publish",
      "usage": "athombv/github-action-homey-app-publish@master",
      "inputs": {
        "personal-access-token": {
          "description": "Homey Personal Access Token",
          "required": true,
          "secret": true
        }
      },
      "outputs": {},
      "example": "uses: athombv/github-action-homey-app-publish@master\nwith:\n  personal-access-token: ${{ secrets.HOMEY_PAT }}"
    }
  },
  "workflows": {
    "homey-official-publish.yml": {
      "name": "Official Homey App Store Publication",
      "description": "Automated publication using official Homey GitHub Actions",
      "triggers": [
        "push to master",
        "workflow_dispatch (manual)"
      ],
      "jobs": [
        {
          "name": "validate",
          "description": "Validate app at publish level",
          "actions_used": ["athombv/github-action-homey-app-validate@master"]
        },
        {
          "name": "version-and-publish",
          "description": "Update version and publish to Homey App Store",
          "actions_used": [
            "athombv/github-action-homey-app-update-version@master",
            "athombv/github-action-homey-app-publish@master"
          ]
        },
        {
          "name": "notify",
          "description": "Send notification about publication status",
          "actions_used": []
        }
      ],
      "secrets_required": ["HOMEY_PAT"],
      "permissions_required": {
        "contents": "write"
      }
    },
    "homey-validate.yml": {
      "name": "Homey App Validation",
      "description": "Validate app on PRs and development branches",
      "triggers": [
        "pull_request to master",
        "push to non-master branches",
        "workflow_dispatch (manual)"
      ],
      "jobs": [
        {
          "name": "validate",
          "description": "Validate app at debug and publish levels",
          "actions_used": ["athombv/github-action-homey-app-validate@master"],
          "strategy": {
            "matrix": {
              "validation-level": ["debug", "publish"]
            }
          }
        },
        {
          "name": "syntax-check",
          "description": "Validate JSON syntax and driver structure",
          "actions_used": []
        }
      ],
      "secrets_required": [],
      "permissions_required": {}
    }
  },
  "validation_levels": {
    "debug": {
      "description": "Development validation - minimal requirements",
      "required_properties": ["id", "version", "name", "description"],
      "optional_properties": ["images", "brandColor", "category"],
      "use_case": "Local development and testing"
    },
    "publish": {
      "description": "Homey Pro publication - standard requirements",
      "required_properties": [
        "id",
        "version",
        "name",
        "description",
        "category",
        "images",
        "brandColor",
        "drivers (with proper structure)"
      ],
      "use_case": "Publication to Homey App Store for Homey Pro"
    },
    "verified": {
      "description": "Verified developer - strict requirements for Homey Cloud",
      "required_properties": [
        "All publish requirements",
        "platforms",
        "connectivity",
        "support"
      ],
      "use_case": "Verified developers publishing to Homey Cloud"
    }
  },
  "publication_flow": {
    "steps": [
      {
        "step": 1,
        "name": "Draft Submission",
        "description": "App uploaded to Homey App Store as Draft",
        "method": "CLI (homey app publish) or GitHub Actions",
        "automatic": true
      },
      {
        "step": 2,
        "name": "Test Release",
        "description": "Promote Draft to Test (no certification needed)",
        "method": "Developer Dashboard",
        "automatic": false,
        "url": "https://tools.developer.homey.app",
        "test_url_format": "https://homey.app/a/{app-id}/test/"
      },
      {
        "step": 3,
        "name": "Certification",
        "description": "Submit Test version for Athom review",
        "method": "Developer Dashboard",
        "automatic": false,
        "review_time": "1-3 business days",
        "requirements": [
          "App Store Guidelines compliance",
          "Functional testing",
          "Asset verification"
        ]
      },
      {
        "step": 4,
        "name": "Live Release",
        "description": "Approved app published to public App Store",
        "method": "Automatic (if enabled) or Manual promotion",
        "automatic": "configurable",
        "live_url_format": "https://homey.app/a/{app-id}/"
      }
    ]
  },
  "secrets_configuration": {
    "HOMEY_PAT": {
      "name": "Homey Personal Access Token",
      "description": "Token for authenticating with Homey App Store API",
      "how_to_obtain": [
        "1. Go to https://tools.developer.homey.app",
        "2. Navigate to Account → Personal Access Tokens",
        "3. Click 'Create new token'",
        "4. Copy token and save in GitHub Secrets"
      ],
      "github_secrets_path": "Repository Settings → Secrets and variables → Actions → New repository secret",
      "required_for": ["publish action"],
      "security_note": "Never commit this token to the repository"
    }
  },
  "best_practices": {
    "automated_publication": {
      "description": "Use GitHub Actions for consistent, traceable releases",
      "benefits": [
        "Automatic version management",
        "Changelog generation",
        "CI/CD integration",
        "Version history tracking"
      ],
      "recommended_workflow": "homey-official-publish.yml"
    },
    "validation": {
      "description": "Always validate before publishing",
      "command": "npx homey app validate --level publish",
      "github_action": "Use homey-validate.yml on all PRs"
    },
    "version_management": {
      "description": "Follow semantic versioning",
      "rules": {
        "patch": "Bug fixes, minor changes (2.1.51 → 2.1.52)",
        "minor": "New features, backwards compatible (2.1.51 → 2.2.0)",
        "major": "Breaking changes (2.1.51 → 3.0.0)"
      }
    },
    "changelog": {
      "description": "Write user-friendly changelog messages",
      "max_length": 400,
      "examples": {
        "good": [
          "Added support for 15 new Tuya temperature sensors",
          "Fixed PIR motion sensor false detection issue",
          "Improved battery reporting accuracy"
        ],
        "bad": [
          "Updated drivers",
          "Bug fixes",
          "Various improvements"
        ]
      }
    },
    "testing": {
      "description": "Always use Test releases before submitting for certification",
      "workflow": [
        "1. Publish to Draft (GitHub Actions)",
        "2. Promote to Test (Dashboard)",
        "3. Test thoroughly with real devices",
        "4. Submit for certification when stable"
      ]
    }
  },
  "troubleshooting": {
    "validation_failed": {
      "symptoms": "GitHub Actions validation job fails",
      "causes": [
        "Missing or incorrect size images",
        "Invalid capabilities",
        "Clusters in string format instead of numeric",
        "Invalid battery types"
      ],
      "solutions": [
        "Run 'npx homey app validate --level publish' locally",
        "Check error messages carefully",
        "Verify all required properties present"
      ]
    },
    "authentication_failed": {
      "symptoms": "Publish action fails with auth error",
      "causes": [
        "HOMEY_PAT secret not configured",
        "Token expired",
        "Incorrect token format"
      ],
      "solutions": [
        "Verify HOMEY_PAT in GitHub Secrets",
        "Regenerate token if expired",
        "Ensure token has correct permissions"
      ]
    },
    "build_already_exists": {
      "symptoms": "Cannot publish - build version already exists",
      "causes": [
        "Previous build still processing",
        "Version not incremented"
      ],
      "solutions": [
        "Wait a few minutes",
        "Manually increment version in app.json",
        "Clean cache: rm -rf .homeybuild .homeycompose"
      ]
    }
  },
  "useful_links": {
    "official_documentation": {
      "publishing_guide": "https://apps.developer.homey.app/app-store/publishing",
      "guidelines": "https://apps.developer.homey.app/app-store/guidelines",
      "sdk_reference": "https://apps.developer.homey.app"
    },
    "github_marketplace": {
      "validate_action": "https://github.com/marketplace/actions/homey-app-validate",
      "version_action": "https://github.com/marketplace/actions/homey-app-update-version",
      "publish_action": "https://github.com/marketplace/actions/homey-app-publish"
    },
    "developer_tools": {
      "dashboard": "https://tools.developer.homey.app",
      "app_store": "https://homey.app/apps",
      "test_url": "https://homey.app/a/com.dlnraja.tuya.zigbee/test/",
      "live_url": "https://homey.app/a/com.dlnraja.tuya.zigbee/"
    }
  }
}
