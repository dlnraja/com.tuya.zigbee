# ğŸ“Š SCHÃ‰MA VISUEL - Cycle Complet Tuya Data Points

**Device**: BSEED 2-gang tactile Zigbee switch  
**Flow**: Homey â†’ Tuya DP â†’ Device

---

## ğŸ”„ CYCLE COMPLET: DP1 (Gang 1) ON

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        HOMEY PRO                               â”‚
â”‚                                                                â”‚
â”‚  1. User action: Turn ON Gang 1                               â”‚
â”‚     â†“                                                          â”‚
â”‚  2. Homey triggers: device.setCapabilityValue('onoff', true)  â”‚
â”‚     â†“                                                          â”‚
â”‚  3. Device receives: set('onoff', true)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DEVICE.JS - BSEED                           â”‚
â”‚                                                                â”‚
â”‚  4. registerCapability('onoff')                                â”‚
â”‚     set: async (value) => {                                    â”‚
â”‚       this.log(`[GANG 1] Setting to: ${value}`);              â”‚
â”‚       return await this.writeTuyaDP(1, value);                â”‚
â”‚     }                                                          â”‚
â”‚     â†“                                                          â”‚
â”‚  5. writeTuyaDP(1, true)                                      â”‚
â”‚     {                                                          â”‚
â”‚       const payload = buildTuyaDPPayload(1, true);            â”‚
â”‚       // Payload: [00 01 01 00 01 01]                        â”‚
â”‚       //           â”‚  â”‚  â”‚  â”‚  â”‚  â””â”€ Value: 0x01 (true)     â”‚
â”‚       //           â”‚  â”‚  â”‚  â””â”€â”€â”´â”€â”€â”€ Length: 0x0001          â”‚
â”‚       //           â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Type: 0x01 (bool)       â”‚
â”‚       //           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ DP: 0x01 (Gang 1)       â”‚
â”‚       //           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Status: 0x00 (command)  â”‚
â”‚     }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ZIGBEE NETWORK LAYER                          â”‚
â”‚                                                                â”‚
â”‚  6. zclNode.endpoints[1].clusters[0xEF00].command(0x00, payload)â”‚
â”‚     â†“                                                          â”‚
â”‚  7. Zigbee frame encapsulation                                â”‚
â”‚     Frame Control: Cluster-specific, Client â†’ Server          â”‚
â”‚     Cluster: 0xEF00 (Tuya Private Cluster)                    â”‚
â”‚     Command: 0x00 (Set Data Point)                            â”‚
â”‚     Payload: [00 01 01 00 01 01]                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                    â‰ˆâ‰ˆâ‰ˆ ZIGBEE AIR â‰ˆâ‰ˆâ‰ˆ
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  BSEED 2-GANG DEVICE                           â”‚
â”‚                                                                â”‚
â”‚  8. Receives Zigbee frame                                     â”‚
â”‚     â†“                                                          â”‚
â”‚  9. Tuya MCU processes DP command                             â”‚
â”‚     DP1 = true â†’ Turn ON relay 1                              â”‚
â”‚     â†“                                                          â”‚
â”‚ 10. Relay 1 activates â†’ Gang 1 ON âœ…                          â”‚
â”‚     â†“                                                          â”‚
â”‚ 11. Send confirmation back                                     â”‚
â”‚     Response: [01 01 01 00 01 01]                            â”‚
â”‚     //         â”‚  â”‚  â”‚  â”‚  â”‚  â””â”€ Value: 0x01 (ON)           â”‚
â”‚     //         â”‚  â”‚  â”‚  â””â”€â”€â”´â”€â”€â”€ Length: 0x0001              â”‚
â”‚     //         â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Type: 0x01 (bool)           â”‚
â”‚     //         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ DP: 0x01 (Gang 1)           â”‚
â”‚     //         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Status: 0x01 (report)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                    â‰ˆâ‰ˆâ‰ˆ ZIGBEE AIR â‰ˆâ‰ˆâ‰ˆ
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ZIGBEE NETWORK LAYER                          â”‚
â”‚                                                                â”‚
â”‚ 12. Receives DP response from device                          â”‚
â”‚     â†“                                                          â”‚
â”‚ 13. Forwards to device.js                                     â”‚
â”‚     tuyaCluster.on('response', (data) => {...})               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DEVICE.JS - BSEED                           â”‚
â”‚                                                                â”‚
â”‚ 14. parseTuyaDPResponse(data)                                 â”‚
â”‚     {                                                          â”‚
â”‚       const status = 0x01; // Report                          â”‚
â”‚       const dp = 0x01;     // Gang 1                          â”‚
â”‚       const type = 0x01;   // bool                            â”‚
â”‚       const value = 0x01;  // true                            â”‚
â”‚     }                                                          â”‚
â”‚     â†“                                                          â”‚
â”‚ 15. updateCapabilityFromDP(1, 0x01, [0x01])                  â”‚
â”‚     {                                                          â”‚
â”‚       const boolValue = true;                                 â”‚
â”‚       await this.setCapabilityValue('onoff', true);           â”‚
â”‚     }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        HOMEY PRO                               â”‚
â”‚                                                                â”‚
â”‚ 16. Capability 'onoff' updated to: true                       â”‚
â”‚     â†“                                                          â”‚
â”‚ 17. UI updates: Gang 1 switch shows ON âœ…                     â”‚
â”‚     â†“                                                          â”‚
â”‚ 18. Flow triggers: "Gang 1 turned on"                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ COMPARAISON: STANDARD vs TUYA DP

### âŒ MÃ‰THODE STANDARD (NE FONCTIONNE PAS)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Homey: endpoint[1].clusters.onoff.setOn()   â”‚
â”‚         â†“                                   â”‚
â”‚ Zigbee: Frame to endpoint 1, cluster 0x0006â”‚
â”‚         â†“                                   â”‚
â”‚ Device: BUG! Activate BOTH relays âŒ        â”‚
â”‚         â†“                                   â”‚
â”‚ Result: Gang 1 ON + Gang 2 ON (incorrect)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### âœ… MÃ‰THODE TUYA DP (FONCTIONNE)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Homey: writeTuyaDP(1, true)                 â”‚
â”‚         â†“                                   â”‚
â”‚ Zigbee: Frame to cluster 0xEF00, DP1       â”‚
â”‚         â†“                                   â”‚
â”‚ Device: Tuya MCU â†’ Relay 1 only âœ…          â”‚
â”‚         â†“                                   â”‚
â”‚ Result: Gang 1 ON, Gang 2 unchanged        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ FLUX PARALLÃˆLES: Gang 1 vs Gang 2

```
GANG 1 (DP1)                    GANG 2 (DP2)
â•â•â•â•â•â•â•â•â•â•â•â•                    â•â•â•â•â•â•â•â•â•â•â•â•

User: Turn ON Gang 1            User: Turn ON Gang 2
      â†“                                â†“
Homey: onoff = true             Homey: onoff.1 = true
      â†“                                â†“
Device: writeTuyaDP(1, true)    Device: writeTuyaDP(2, true)
      â†“                                â†“
Payload: [00 01 01 00 01 01]   Payload: [00 02 01 00 01 01]
         â”‚  â”‚  â”‚  â”‚  â”‚  â””â”€ ON           â”‚  â”‚  â”‚  â”‚  â”‚  â””â”€ ON
         â”‚  â”‚  â”‚  â””â”€â”€â”´â”€ 1 byte          â”‚  â”‚  â”‚  â””â”€â”€â”´â”€ 1 byte
         â”‚  â”‚  â””â”€â”€â”€â”€â”€ bool               â”‚  â”‚  â””â”€â”€â”€â”€â”€ bool
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€ DP1 âœ…             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€ DP2 âœ…
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ cmd                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ cmd
      â†“                                â†“
Zigbee: Cluster 0xEF00          Zigbee: Cluster 0xEF00
      â†“                                â†“
Device: Relay 1 ON âœ…            Device: Relay 2 ON âœ…
      â†“                                â†“
Response: DP1 = true            Response: DP2 = true
      â†“                                â†“
Homey: Gang 1 ON âœ…              Homey: Gang 2 ON âœ…
```

---

## ğŸ“ˆ SÃ‰QUENCE TEMPORELLE

```
Time    Homey           Device.js        Zigbee         BSEED Device
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0ms     User clicks     
        "Gang 1 ON"
        
10ms                    writeTuyaDP(1)
                        Build payload
                        
20ms                                     Send frame
                                         Cluster 0xEF00
                                         
30ms                                                    Receive frame
                                                        Parse DP1
                                                        
40ms                                                    Activate relay 1
                                                        Gang 1 ON âœ…
                                                        
50ms                                                    Send response
                                                        DP1 = true
                                                        
60ms                                     Receive
                                         response
                                         
70ms                    Parse response
                        Update capability
                        
80ms    UI updates
        Gang 1 ON âœ…
        
90ms    Flow triggers
        "Gang 1 ON"
```

---

## ğŸ” DÃ‰BOGAGE: Logs Typiques

### Logs SUCCESS âœ…

```
[2025-11-02 14:30:00] [GANG 1] Setting to: true
[2025-11-02 14:30:00] [TUYA DP] Writing DP1 = true
[2025-11-02 14:30:00] [TUYA DP] Payload DP1: 0001010001
[2025-11-02 14:30:00] âœ… DP1 written successfully
[2025-11-02 14:30:00] [TUYA DP] Response: 0101010001
[2025-11-02 14:30:00] [TUYA DP] Parsing response: 0101010001
[2025-11-02 14:30:00] [TUYA DP] DP1 type=1 value=01
[2025-11-02 14:30:00] [TUYA DP] Updating onoff = true
[2025-11-02 14:30:00] âœ… Capability updated: onoff = true
```

### Logs ERROR âŒ (Standard Endpoints)

```
[2025-11-02 14:25:00] [GANG 1] Using standard endpoint 1
[2025-11-02 14:25:00] Sending: endpoint[1].clusters.onoff.setOn()
[2025-11-02 14:25:00] âŒ UNEXPECTED: Gang 2 also activated!
[2025-11-02 14:25:00] âš ï¸ Firmware bug: Both relays respond to single endpoint
[2025-11-02 14:25:00] ğŸ’¡ Solution: Use Tuya DPs instead
```

---

**Status**: âœ… SCHÃ‰MA COMPLET  
**Clarity**: Cycle end-to-end visualisÃ©  
**Next**: Voir exemple pas-Ã -pas avec logs rÃ©els
