# üìñ Guide Officiel de Publication - Universal Tuya Zigbee

**Date:** 2025-10-11  
**Version App:** 2.1.51  
**Bas√© sur:** [Documentation Officielle Homey](https://apps.developer.homey.app/app-store/publishing)

---

## üéØ Vue d'ensemble

Ce guide documente le **processus officiel** de publication selon la documentation Homey, en remplacement des approches complexes pr√©c√©dentes.

### ‚úÖ Changements Majeurs

| Avant | Maintenant |
|-------|------------|
| Scripts PowerShell complexes | ‚úÖ Actions officielles GitHub Marketplace |
| Gestion manuelle des prompts | ‚úÖ Workflows automatis√©s |
| Buffer workarounds | ‚úÖ API officielle Homey |
| Multiples tentatives | ‚úÖ Processus standard valid√© |

---

## üì¶ Actions Officielles Utilis√©es

### 1. **Homey App Validate**
```yaml
uses: athombv/github-action-homey-app-validate@master
```
- **Source:** https://github.com/marketplace/actions/homey-app-validate
- **Purpose:** Valide l'app selon les standards Homey
- **Niveaux:** debug, publish, verified

### 2. **Homey App Update Version**
```yaml
uses: athombv/github-action-homey-app-update-version@master
with:
  version: patch  # ou minor, major
  changelog: "Description des changements"
```
- **Source:** https://github.com/marketplace/actions/homey-app-update-version
- **Purpose:** Incr√©mente version + g√©n√®re changelog
- **Versioning:** Semantic (patch/minor/major)

### 3. **Homey App Publish**
```yaml
uses: athombv/github-action-homey-app-publish@master
with:
  personal-access-token: ${{ secrets.HOMEY_PAT }}
```
- **Source:** https://github.com/marketplace/actions/homey-app-publish
- **Purpose:** Publie sur Homey App Store
- **Requiert:** Secret `HOMEY_PAT`

---

## üöÄ Workflow Principal

### Fichier: `.github/workflows/homey-official-publish.yml`

**D√©clencheurs:**
- ‚úÖ Push automatique sur `master`
- ‚úÖ Manuel via GitHub UI (`workflow_dispatch`)

**Processus:**

```mermaid
graph TD
    A[Push to master] --> B[Job: validate]
    B --> C[Official Validate Action]
    C --> D{Valid?}
    D -->|‚úÖ Yes| E[Job: version-and-publish]
    D -->|‚ùå No| F[Fail & Report]
    E --> G[Update Version Action]
    G --> H[Commit Version]
    H --> I[Publish Action]
    I --> J[Notification]
```

**√âtapes d√©taill√©es:**

1. **Validation**
   ```bash
   athombv/github-action-homey-app-validate@master
   Level: publish
   ```

2. **Versioning**
   ```bash
   athombv/github-action-homey-app-update-version@master
   Type: patch (auto) ou manuel
   Changelog: G√©n√©r√© auto depuis commit
   ```

3. **Publication**
   ```bash
   athombv/github-action-homey-app-publish@master
   Auth: HOMEY_PAT secret
   ```

4. **Commit**
   ```bash
   git commit "chore: bump version to vX.X.X [skip ci]"
   git push origin master
   ```

---

## üîë Configuration Requise

### Secret GitHub: `HOMEY_PAT`

**Comment l'obtenir:**

1. **Aller sur Homey Developer Dashboard**
   ```
   https://tools.developer.homey.app
   ```

2. **Naviguer vers Personal Access Tokens**
   ```
   Account ‚Üí Personal Access Tokens
   ```

3. **Cr√©er nouveau token**
   - Click "Create new token"
   - Copier le token g√©n√©r√©

4. **Ajouter dans GitHub Secrets**
   ```
   Repository Settings
     ‚Üí Secrets and variables
       ‚Üí Actions
         ‚Üí New repository secret
           Name: HOMEY_PAT
           Value: <votre token>
   ```

**‚ö†Ô∏è Important:**
- Ne jamais committer le token dans le code
- Le token donne acc√®s √† votre compte d√©veloppeur
- Peut √™tre r√©voqu√© et r√©g√©n√©r√© si n√©cessaire

---

## üìù Utilisation Pratique

### M√©thode 1: Publication Automatique (Recommand√©e)

**√âtape 1: D√©veloppement Local**
```bash
# Installer d√©pendances
npm install

# Valider avant commit
npx homey app validate --level publish
```

**√âtape 2: Commit & Push**
```bash
git add .
git commit -m "feat: add support for new temperature sensors"
git push origin master
```

**√âtape 3: GitHub Actions**
- ‚úÖ S'ex√©cute automatiquement
- ‚úÖ Valide l'app
- ‚úÖ Incr√©mente version (patch)
- ‚úÖ Publie sur Homey

**√âtape 4: Dashboard Homey**
1. Aller sur https://tools.developer.homey.app
2. Apps SDK ‚Üí My Apps
3. Universal Tuya Zigbee v2.1.52 (nouvelle version)
4. Choisir:
   - **Test Release** (pas de certification)
   - **Live Release** (certification Athom)

---

### M√©thode 2: Publication Manuelle

**Via GitHub UI:**

```
GitHub Repository
  ‚Üí Actions
    ‚Üí Official Homey App Store Publication
      ‚Üí Run workflow
        Branch: master
        Version type: patch/minor/major
        Changelog: "Custom message"
```

**Via Script PowerShell:**

```powershell
# Publication standard
.\scripts\automation\publish-homey-official.ps1

# Version mineure
.\scripts\automation\publish-homey-official.ps1 -VersionType minor

# Avec changelog personnalis√©
.\scripts\automation\publish-homey-official.ps1 `
  -Changelog "Added 20 new device models"

# Dry run (test)
.\scripts\automation\publish-homey-official.ps1 -DryRun
```

**Via CLI Homey:**

```bash
# M√©thode officielle la plus simple
cd "c:\Users\HP\Desktop\homey app\tuya_repair"
npx homey app publish
```

---

## üéØ Flux de Publication Complet

### Phase 1: Draft ‚Üí Test

```
1. GitHub Actions publie ‚Üí DRAFT cr√©√©
2. Dashboard Homey ‚Üí Voir nouveau build
3. Promouvoir vers TEST (manuel)
4. Test URL activ√©e: https://homey.app/a/com.dlnraja.tuya.zigbee/test/
```

**Avantages Test:**
- ‚úÖ Pas de certification n√©cessaire
- ‚úÖ URL priv√©e pour beta-testeurs
- ‚úÖ Peut √™tre mis √† jour instantan√©ment
- ‚úÖ Permet tests r√©els avant certification

### Phase 2: Test ‚Üí Certification

```
1. Dashboard ‚Üí Submit for certification
2. Athom Review (1-3 jours ouvrables)
   - V√©rification App Store Guidelines
   - Tests fonctionnels basiques
   - V√©rification assets/images
3. Notification approval/rejection
```

**Checklist Certification:**
- [ ] App passe `homey app validate --level publish`
- [ ] Description claire et user-friendly
- [ ] Images de qualit√© (75x75, 500x500)
- [ ] Pas de sur-promesses marketing
- [ ] Respecte guidelines Athom

### Phase 3: Live Release

```
1. After approval:
   - Auto-publish (si configur√©)
   - OU promotion manuelle
2. Live URL activ√©e: https://homey.app/a/com.dlnraja.tuya.zigbee/
3. Visible dans Homey App Store public
4. Disponible pour tous les utilisateurs
```

---

## üîç Validation Locale

### Commandes Essentielles

```bash
# Validation publish (requis)
npx homey app validate --level publish

# Validation debug (d√©veloppement)
npx homey app validate --level debug

# Validation verified (d√©veloppeurs certifi√©s)
npx homey app validate --level verified

# Build sans publication
npx homey app build
```

### Niveaux de Validation

| Niveau | Usage | Requirements |
|--------|-------|--------------|
| **debug** | D√©veloppement local | Minimal (id, version, name) |
| **publish** | Publication Homey Pro | Standard (images, category, etc.) |
| **verified** | Homey Cloud | Stricte (platforms, connectivity) |

---

## ‚úÖ Checklist Pre-Publication

### Avant chaque push sur master:

- [ ] `npx homey app validate --level publish` ‚úÖ PASSED
- [ ] Tous les drivers ont images (small.png, large.png)
- [ ] CHANGELOG.md mis √† jour avec changements
- [ ] README.md d√©crit fonctionnalit√©s actuelles
- [ ] Pas de credentials hardcod√©s dans le code
- [ ] `.gitignore` √† jour (node_modules, .homeybuild, etc.)
- [ ] Git clean (pas de fichiers non commit√©s)

### Configuration GitHub:

- [ ] Secret `HOMEY_PAT` configur√©
- [ ] Workflows dans `.github/workflows/`
- [ ] Permissions `contents: write` d√©finies

---

## üêõ D√©pannage

### Erreur: "Validation failed"

**Diagnostic:**
```bash
npx homey app validate --level publish
```

**Causes fr√©quentes:**
1. Images manquantes ou mauvaise taille
2. Clusters Zigbee en string au lieu de numeric
3. Capabilities invalides
4. Battery types incorrects (doit √™tre: CR2032, AA, PP3, etc.)

**Solution:**
- Lire attentivement le message d'erreur
- Corriger les probl√®mes identifi√©s
- Re-valider avant push

### Erreur: "Authentication failed"

**Causes:**
- Secret `HOMEY_PAT` non configur√©
- Token expir√©
- Token incorrect

**Solutions:**
1. V√©rifier GitHub Secrets
2. R√©g√©n√©rer token sur Homey Dashboard
3. Mettre √† jour secret GitHub

### Erreur: "Build already exists"

**Causes:**
- Version non incr√©ment√©e
- Build pr√©c√©dent encore en traitement

**Solutions:**
1. Attendre 2-3 minutes
2. Nettoyer cache: `rm -rf .homeybuild .homeycompose`
3. Incr√©menter manuellement si n√©cessaire

### Workflow ne se d√©clenche pas

**V√©rifications:**
1. GitHub Actions activ√© dans Settings
2. Workflow file bien dans `.github/workflows/`
3. Syntaxe YAML correcte (pas d'erreurs lint)
4. Permissions repository appropri√©es

---

## üìä Monitoring

### GitHub Actions

**Acc√®s:**
```
Repository ‚Üí Actions ‚Üí Choose workflow ‚Üí View run
```

**Indicateurs de succ√®s:**
- ‚úÖ Tous les jobs verts
- üìù Summary tab avec version info
- üîó Links vers Dashboard Homey

**En cas d'√©chec:**
- ‚ùå Job rouge
- üìã Logs d√©taill√©s dans job
- üîç Error messages pour debug

### Homey Developer Dashboard

**URL:**
```
https://tools.developer.homey.app/apps/app/com.dlnraja.tuya.zigbee
```

**Sections:**
- **Builds** - Tous les builds upload√©s
- **Test** - Gestion releases Test
- **Live** - Gestion releases Live
- **Certification** - Statut reviews Athom

---

## üìö Ressources Officielles

### Documentation Homey

- **Publishing Guide:** https://apps.developer.homey.app/app-store/publishing
- **App Store Guidelines:** https://apps.developer.homey.app/app-store/guidelines
- **SDK Reference:** https://apps.developer.homey.app
- **Validation Levels:** https://apps.developer.homey.app/app-store/publishing#requirements

### GitHub Marketplace

- **Validate Action:** https://github.com/marketplace/actions/homey-app-validate
- **Version Action:** https://github.com/marketplace/actions/homey-app-update-version
- **Publish Action:** https://github.com/marketplace/actions/homey-app-publish

### Developer Tools

- **Dashboard:** https://tools.developer.homey.app
- **App Store:** https://homey.app/apps
- **Test URL:** https://homey.app/a/com.dlnraja.tuya.zigbee/test/
- **Live URL:** https://homey.app/a/com.dlnraja.tuya.zigbee/

---

## üìÅ Fichiers Importants

### Workflows GitHub Actions

```
.github/workflows/
‚îú‚îÄ‚îÄ homey-official-publish.yml    ‚≠ê Workflow principal (recommand√©)
‚îú‚îÄ‚îÄ homey-validate.yml            Validation continue (PRs)
‚îú‚îÄ‚îÄ OFFICIAL_WORKFLOWS_GUIDE.md   Guide complet workflows
‚îî‚îÄ‚îÄ WORKFLOWS.md                  Documentation g√©n√©rale
```

### Scripts Locaux

```
scripts/automation/
‚îî‚îÄ‚îÄ publish-homey-official.ps1    Script PowerShell de publication
```

### R√©f√©rentiels

```
references/
‚îî‚îÄ‚îÄ github_actions_official.json  R√©f√©rentiel technique complet
```

---

## üéØ Prochaines √âtapes

### Imm√©diat

1. **Configurer HOMEY_PAT** (si pas d√©j√† fait)
2. **Valider app localement**
   ```bash
   npx homey app validate --level publish
   ```
3. **Tester workflow** via commit simple

### Court Terme

1. **Premi√®re publication Test**
   - Push vers master
   - V√©rifier GitHub Actions
   - Promouvoir vers Test sur Dashboard

2. **Tests communautaires**
   - Partager Test URL avec beta-testeurs
   - Collecter feedback
   - Corriger bugs identifi√©s

### Moyen Terme

1. **Soumission certification**
   - Apr√®s tests concluants
   - Submit for certification via Dashboard
   - Attendre approval Athom

2. **Live release**
   - Apr√®s certification
   - Promouvoir vers Live
   - Annonce sur forum Homey Community

---

## üìû Support

### Issues GitHub
https://github.com/dlnraja/com.tuya.zigbee/issues

### Forum Homey Community
https://community.homey.app/t/app-pro-universal-tuya-zigbee-device-app-lite-version/140352/

### Contact Direct
Dylan Rajasekaram - Maintainer du projet

---

**Derni√®re mise √† jour:** 2025-10-11  
**Version du guide:** 1.0.0  
**Statut:** ‚úÖ Production Ready
