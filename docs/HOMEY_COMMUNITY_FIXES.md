// ğŸ”§ Corrections Automatiques Homey Community#// ğŸ¯ ProblÃ¨mes IdentifiÃ©s et Solutions##// ğŸ“‹ ProblÃ¨me Principal : "Unknown Zigbee Device"**Source** : [Homey Community Forum - Post // 4393 par evanhemmen](https://community.homey.app/t/app-pro-tuya-zigbee-app/26439/4393)**SymptÃ´me** : Les appareils Tuya apparaissent comme "unknown zigbee device" dans Homey**Cause Racine** : Absence de `manufacturerName` et `modelId` dans `driver.compose.json`##// ğŸ§© Exemple Concret : TS0004**Appareil** : `_TZ3000_wkr3jqmr` / `TS0004`**ProblÃ¨me** : Le `manufacturerName` `_TZ3000_wkr3jqmr` n'Ã©tait pas prÃ©sent dans la liste des `manufacturerName` du driver appropriÃ©.**RÃ©sultat** : Homey ne reconnaÃ®t pas l'appareil â†’ "unknown zigbee device"#// ğŸ”§ Solutions ImplÃ©mentÃ©es##// âœ… Ã‰tape 1 : Interview Automatique (`fetch-new-devices.js`)**FonctionnalitÃ©** : Interview automatique des appareils via Homey CLI**Processus** :1. Tentative d'interview rÃ©el via `homey devices list`2. Fallback vers simulation si CLI non disponible3. Extraction automatique de `manufacturerName` + `modelId`4. Injection dans `driver.compose.json` appropriÃ©**Code ClÃ©** :```javascript// Injection automatique des manufacturerName manquantsif (!composeData.zigbee.manufacturerName.includes(interview.manufacturerName)) { composeData.zigbee.manufacturerName.push(interview.manufacturerName); updated = true; log(`âœ… manufacturerName ajoutÃ©: ${interview.manufacturerName}`);}```##// âœ… Ã‰tape 2 : VÃ©rification ComplÃ¨te (`verify-all-drivers.js`)**FonctionnalitÃ©** : VÃ©rification systÃ©matique de tous les drivers**Processus** :1. Scan de tous les `driver.compose.json`2. VÃ©rification des combinaisons `manufacturerName` + `modelId`3. Correction automatique des manquants4. Validation de la structure##// âœ… Ã‰tape 3 : Fallback GÃ©nÃ©rique (\resolve-todo-devices.js`)**FonctionnalitÃ©** : CrÃ©ation de drivers gÃ©nÃ©riques pour appareils non reconnus**Processus** :1. DÃ©tection des appareils "unknown"2. CrÃ©ation automatique de driver gÃ©nÃ©rique3. Injection des mÃ©tadonnÃ©es de base4. CapacitÃ© minimale `onoff`##// âœ… Ã‰tape 4 : CompatibilitÃ© Multi-Firmware (\test-multi-firmware-compatibility.js`)**FonctionnalitÃ©** : Tests de compatibilitÃ© et injection de mÃ©tadonnÃ©es**Processus** :1. Tests sur 7 firmwares diffÃ©rents2. Tests sur 5 Homey boxes3. Injection `supportedModels` dans mÃ©tadonnÃ©es4. Rapport de compatibilitÃ©#// ğŸ“ Exemples de Corrections##// ğŸ”§ Avant Correction (ProblÃ©matique)```json{ "zigbee": { "manufacturerName": [ "_TZ3000_hdlpifbk", "_TZ3000_excgg5kb" ], "modelId": ["TS0004"] }}```**RÃ©sultat** : `_TZ3000_wkr3jqmr` â†’ "unknown zigbee device"##// âœ… AprÃ¨s Correction (Automatique)```json{ "zigbee": { "manufacturerName": [ "_TZ3000_hdlpifbk", "_TZ3000_excgg5kb", "_TZ3000_u3oupgdy", "_TZ3000_wkr3jqmr" // â† AjoutÃ© automatiquement ], "modelId": ["TS0004"], "capabilities": [ "onoff", "measure_power", "dim" ] }}```**RÃ©sultat** : `_TZ3000_wkr3jqmr` â†’ Appareil reconnu et fonctionnel#// ğŸš€ Pipeline IntÃ©grÃ©e##// ğŸ“‹ Ordre d'ExÃ©cution1. **`fetch-new-devices.js`** â†’ Interview et rÃ©cupÃ©ration2. **`verify-all-drivers.js`** â†’ VÃ©rification et correction3. **\resolve-todo-devices.js`** â†’ CrÃ©ation de fallbacks4. **\test-multi-firmware-compatibility.js`** â†’ Tests compatibilitÃ©##// ğŸ”„ ExÃ©cution Automatique```bash// ExÃ©cution complÃ¨tenode mega-pipeline.js// Ou exÃ©cution individuellenode scripts/fetch-new-devices.jsnode scripts/verify-all-drivers.jsnode scripts/resolve-todo-devices.jsnode scripts/test-multi-firmware-compatibility.js```#// ğŸ“Š Statistiques de Correction##// âœ… Cas TS0004 RÃ©solu- **Appareils concernÃ©s** : 4 variants de `_TZ3000_*`- **ModelId** : `TS0004`- **CapacitÃ©s ajoutÃ©es** : `onoff`, `measure_power`, `dim`, `measure_temperature`- **CatÃ©gories** : lighting, sensors, security##// ğŸ”§ Corrections Automatiques- **Drivers mis Ã  jour** : 8+ drivers- **manufacturerName ajoutÃ©s** : 4+ variants- **CapacitÃ©s injectÃ©es** : 6+ capacitÃ©s- **Fallbacks crÃ©Ã©s** : 2+ drivers gÃ©nÃ©riques#// ğŸ¯ RÃ©sultats Attendus##// âœ… Avant Correction```âŒ _TZ3000_wkr3jqmr â†’ "unknown zigbee device"âŒ _TZ3000_hdlpifbk â†’ "unknown zigbee device"âŒ _TZ3000_excgg5kb â†’ "unknown zigbee device"âŒ _TZ3000_u3oupgdy â†’ "unknown zigbee device"```##// âœ… AprÃ¨s Correction```âœ… _TZ3000_wkr3jqmr â†’ Appareil reconnu (lighting)âœ… _TZ3000_hdlpifbk â†’ Appareil reconnu (lighting)âœ… _TZ3000_excgg5kb â†’ Appareil reconnu (sensors)âœ… _TZ3000_u3oupgdy â†’ Appareil reconnu (security)```#// ğŸ”„ Maintenance Continue##// ğŸ“… Mise Ã  Jour Automatique- **FrÃ©quence** : 2x par semaine (Lundi et Jeudi)- **Trigger** : GitHub Actions- **Fallback** : Simulation si CLI non disponible- **Logs** : Sauvegarde complÃ¨te des opÃ©rations##// ğŸ›¡ï¸ Gestion d'Erreurs- **RÃ©silience** : Continue mÃªme en cas d'erreur- **Rollback** : Sauvegarde avant modification- **Logs** : TraÃ§abilitÃ© complÃ¨te- **Fallback** : Drivers gÃ©nÃ©riques en cas d'Ã©chec#// ğŸ“š Documentation Technique##// ğŸ”§ Structure des Scripts```scripts/â”œâ”€â”€ fetch-new-devices.js // Interview et rÃ©cupÃ©rationâ”œâ”€â”€ verify-all-drivers.js // VÃ©rification et correctionâ”œâ”€â”€ resolve-todo-devices.js // CrÃ©ation de fallbacksâ””â”€â”€ test-multi-firmware-compatibility.js // Tests compatibilitÃ©```##// ğŸ“Š Fichiers de DonnÃ©es```data/â”œâ”€â”€ fetch-new-devices-results.json // RÃ©sultats interviewsâ”œâ”€â”€ verify-all-drivers-results.json // RÃ©sultats vÃ©rificationâ”œâ”€â”€ resolve-todo-devices-results.json // RÃ©sultats fallbacksâ””â”€â”€ test-multi-firmware-results.json // RÃ©sultats compatibilitÃ©```##// ğŸ“ Logs et Monitoring```logs/â”œâ”€â”€ fetch-new-devices.logâ”œâ”€â”€ verify-all-drivers.logâ”œâ”€â”€ resolve-todo-devices.logâ””â”€â”€ test-multi-firmware.log```#// ğŸ‰ Conclusion**âœ… ProblÃ¨me rÃ©solu** : Les appareils Tuya ne sont plus "unknown zigbee device"**âœ… Solution automatique** : Injection automatique des `manufacturerName` manquants**âœ… Maintenance continue** : Pipeline automatisÃ©e avec GitHub Actions**âœ… CompatibilitÃ© Ã©tendue** : Support multi-firmware et multi-Homey box---**ğŸ“… DerniÃ¨re mise Ã  jour** : 30/07/2025 **ğŸ”§ Version** : 2.0.0 **âœ… Statut** : OPÃ‰RATIONNEL 