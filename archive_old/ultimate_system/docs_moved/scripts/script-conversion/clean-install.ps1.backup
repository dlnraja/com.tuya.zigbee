# Script de nettoyage et réinstallation complète
Write-Host "=== Nettoyage et réinstallation complète ===" -ForegroundColor Cyan

# Vérification de l'environnement
Write-Host "`n1. Vérification de l'environnement..." -ForegroundColor Green
$nodeVersion = node --version
$npmVersion = npm --version
Write-Host "- Node.js: $nodeVersion"
Write-Host "- npm: $npmVersion"

# Nettoyage
Write-Host "`n2. Nettoyage du projet..." -ForegroundColor Green
if (Test-Path "node_modules") {
    Write-Host "- Suppression du dossier node_modules..."
    Remove-Item -Recurse -Force node_modules
}

if (Test-Path "package-lock.json") {
    Write-Host "- Suppression du fichier package-lock.json..."
    Remove-Item -Force package-lock.json
}

# Création d'un package.json minimal si nécessaire
if (-not (Test-Path "package.json")) {
    Write-Host "- Création d'un package.json minimal..."
    @{
        "name" = "tuya-zigbee-temp"
        "version" = "1.0.0"
        "private" = $true
        "dependencies" = @{}
        "devDependencies" = @{}
    } | ConvertTo-Json | Set-Content -Path "package.json"
}

# Installation des dépendances de base
Write-Host "`n3. Installation des dépendances de base..." -ForegroundColor Green
$dependencies = @(
    "axios@1.6.2",
    "uuid@9.0.0",
    "chalk@5.3.0",
    "fs-extra@11.1.1",
    "glob@10.3.3"
)

Write-Host "- Installation des dépendances principales..."
npm install --save $dependencies

# Installation des dépendances de développement
Write-Host "`n4. Installation des dépendances de développement..." -ForegroundColor Green
$devDependencies = @(
    "eslint@8.55.0",
    "eslint-config-airbnb-base@15.0.0",
    "eslint-plugin-import@2.29.0",
    "typescript@5.1.6",
    "ts-node@10.9.1"
)

Write-Host "- Installation des dépendances de développement..."
npm install --save-dev $devDependencies

# Vérification finale
Write-Host "`n5. Vérification de l'installation..." -ForegroundColor Green
npm list --depth=0

Write-Host "`n=== Installation terminée ===" -ForegroundColor Green
Write-Host "Pour lancer le projet, utilisez: npm start" -ForegroundColor Cyan
Write-Host "Pour vérifier les erreurs: npm run lint" -ForegroundColor Cyan

# Attendre l'entrée utilisateur avant de fermer
Write-Host "`nAppuyez sur une touche pour continuer..." -ForegroundColor Cyan
$null = $Host.UI.RawUI.ReadKey('NoEcho,IncludeKeyDown')
