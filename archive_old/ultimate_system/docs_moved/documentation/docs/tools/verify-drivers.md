# Driver Validation Tool## OverviewThe `tools/verify-drivers.js` tool is a comprehensive validation system for Tuya Zigbee device drivers. It ensures all drivers meet the required standards and identifies potential issues.## Features### Validation Checks- **File Structure**: Validates driver file structure- **Required Fields**: Checks for mandatory fields- **Zigbee Configuration**: Validates Zigbee cluster configuration- **Device Capabilities**: Verifies device capability definitions- **JSON Syntax**: Ensures valid JSON format- **Path References**: Validates file and asset references### Reporting- **Detailed Reports**: Comprehensive validation reports- **Error Classification**: Categorizes issues by severity- **Statistics**: Provides validation statistics- **Export Options**: Multiple export formats (JSON, Markdown, HTML)## Usage### Basic Usage```bash# Validate all driversnode tools/verify-drivers.js# Validate specific drivernode tools/verify-drivers.js --driver switch_1_gang# Generate reportnode tools/verify-drivers.js --report```### Advanced Usage```bash# Validate with custom rulesnode tools/verify-drivers.js --rules custom-rules.json# Export to specific formatnode tools/verify-drivers.js --export markdown# Verbose outputnode tools/verify-drivers.js --verbose```## Validation Rules### Required Fields- `id`: Unique driver identifier- `title`: Human-readable driver name- `icon`: Driver icon path- `class`: Device class (light, switch, sensor, etc.)- `capabilities`: Array of device capabilities- `zigbee`: Zigbee configuration object### Zigbee Configuration```json{ "zigbee": { "manufacturerName": "Tuya", "modelId": "TS0001", "endpoints": { "1": { "clusters": { "input": ["genBasic", "genOnOff"], "output": ["genBasic", "genOnOff"] } } } }}```### Device Capabilities- **Switches**: `onoff`, `dim`- **Lights**: `onoff`, `dim`, `light_hue`, `light_saturation`, `light_temperature`- **Sensors**: `measure_temperature`, `measure_humidity`, `alarm_motion`- **Controllers**: `button`, `remote`## Error Types### Critical Errors- **Missing required fields**: Driver won't function- **Invalid JSON**: Syntax errors- **Missing files**: Referenced files don't exist- **Invalid paths**: Incorrect file references### Warnings- **Missing optional fields**: Reduced functionality- **Deprecated features**: Outdated implementations- **Performance issues**: Suboptimal configurations- **Documentation gaps**: Missing documentation### Information- **Best practices**: Suggestions for improvement- **Optimization opportunities**: Performance improvements- **Feature suggestions**: Additional capabilities- **Documentation updates**: Documentation improvements## Output Formats### Console Output```🔍 Validating drivers...✅ switch_1_gang: Valid❌ rgb_bulb: Missing zigbee.endpoint⚠️ temperature_sensor: Missing documentation📊 Validation complete: 148 drivers checked```### JSON Report```json{ "summary": { "total": 148, "valid": 145, "errors": 2, "warnings": 1 }, "drivers": { "switch_1_gang": { "status": "valid", "issues": [] }, "rgb_bulb": { "status": "error", "issues": ["Missing zigbee.endpoint"] } }}```### Markdown Report```markdown# Driver Validation Report## Summary- **Total Drivers**: 148- **Valid**: 145- **Errors**: 2- **Warnings**: 1## Issues Found### Critical Errors- rgb_bulb: Missing zigbee.endpoint- temperature_sensor: Invalid JSON syntax### Warnings- switch_1_gang: Missing documentation```## Configuration### Custom Rules```json{ "rules": { "required_fields": ["id", "title", "icon", "class"], "zigbee_required": true, "capabilities_required": true, "documentation_required": false }}```### Validation Options```json{ "options": { "strict": true, "verbose": false, "report_format": "markdown", "output_file": "validation-report.md" }}```## Integration### GitHub Actions```yaml- name: Validate Drivers run: node tools/verify-drivers.js --report --export markdown```### Pre-commit Hook```bash#!/bin/bashnode tools/verify-drivers.js --strictif [ $? -ne 0 ]; then echo "Driver validation failed" exit 1fi```### Continuous Integration```yaml- name: Driver Validation run: | node tools/verify-drivers.js --report node tools/verify-drivers.js --export json > validation-report.json```## Troubleshooting### Common Issues- **Missing dependencies**: Install required Node.js packages- **Permission errors**: Check file permissions- **Path issues**: Verify file paths are correct- **Memory issues**: Increase Node.js memory limit### Debug Mode```bash# Enable debug outputDEBUG=* node tools/verify-drivers.js# Verbose loggingnode tools/verify-drivers.js --verbose --debug```## Best Practices### Driver Development1. **Use the validation tool**: Run validation before committing2. **Follow standards**: Adhere to driver development standards3. **Test thoroughly**: Test drivers with actual devices4. **Document properly**: Include comprehensive documentation5. **Update regularly**: Keep drivers up to date### Validation Process1. **Run validation**: Use the tool regularly2. **Review reports**: Analyze validation results3. **Fix issues**: Address critical errors first4. **Improve quality**: Address warnings and suggestions5. **Maintain standards**: Keep validation rules updated## References- [Homey SDK3 Documentation](https://apps.athom.com/docs/)- [Zigbee Cluster Library](https://zigbeealliance.org/specifications/)- [Tuya Developer Documentation](https://developer.tuya.com/)- [Driver Development Guide](docs/development/driver-development.md) 