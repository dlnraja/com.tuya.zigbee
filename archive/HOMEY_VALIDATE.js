const { execSync } = require("child_process"); const fs = require("fs"); const path = require("path"); console.log("ğŸ” HOMEY VALIDATE - Validation des drivers..."); function validateDrivers() { const driversPath = path.join(process.cwd(), "drivers"); if (!fs.existsSync(driversPath)) { console.error("âŒ Dossier drivers non trouvÃ©"); return { valid: 0, invalid: 0 }; } const driverDirs = fs.readdirSync(driversPath, { withFileTypes: true }).filter(d => d.isDirectory()).map(d => d.name); console.log(`ğŸ“ TrouvÃ© ${driverDirs.length} drivers Ã  valider`); let valid = 0; let invalid = 0; for (const driverDir of driverDirs) { const driverPath = path.join(driversPath, driverDir); const composePath = path.join(driverPath, "driver.compose.json"); const devicePath = path.join(driverPath, "device.js"); if (fs.existsSync(composePath) && fs.existsSync(devicePath)) { try { const compose = JSON.parse(fs.readFileSync(composePath, "utf8")); if (compose.id && compose.name && compose.class && compose.capabilities) { console.log(`  âœ… ${driverDir} - VALIDE`); valid++; } else { console.log(`  âŒ ${driverDir} - INVALIDE (compose.json incomplet)`); invalid++; } } catch (error) { console.log(`  âŒ ${driverDir} - INVALIDE (JSON invalide)`); invalid++; } } else { console.log(`  âŒ ${driverDir} - INVALIDE (fichiers manquants)`); invalid++; } } return { valid, invalid }; } try { const { valid, invalid } = validateDrivers(); console.log(`\nğŸ‰ VALIDATION TERMINÃ‰E !`); console.log(`âœ… Drivers valides: ${valid}`); console.log(`âŒ Drivers invalides: ${invalid}`); console.log(`ğŸ“Š Total: ${valid + invalid}`); console.log("::END::HOMEY_VALIDATE::OK"); process.exit(0); } catch (error) { console.error("ğŸ’¥ Erreur fatale:", error); console.log("::END::HOMEY_VALIDATE::FAIL"); process.exit(1); }
