const { execSync } = require("child_process"); const fs = require("fs"); const path = require("path"); console.log("ğŸ” HOMEY VALIDATE - Validation des drivers avec Homey..."); function validateWithHomey() { const driversPath = path.join(process.cwd(), "drivers"); if (!fs.existsSync(driversPath)) { console.error("âŒ Dossier drivers non trouvÃ©"); return { valid: 0, invalid: 0 }; } const driverDirs = fs.readdirSync(driversPath, { withFileTypes: true }).filter(d => d.isDirectory()).map(d => d.name); console.log(`ğŸ“ TrouvÃ© ${driverDirs.length} drivers Ã  valider avec Homey`); let valid = 0; let invalid = 0; for (const driverDir of driverDirs.slice(0, 5)) { const driverPath = path.join(driversPath, driverDir); console.log(`\nğŸ” Validation de ${driverDir}...`); try { const result = execSync(`cd "${driverPath}" && npx homey app validate`, { encoding: "utf8", stdio: "pipe" }); if (result.includes("Validation successful")) { console.log(`  âœ… ${driverDir} - VALIDE`); valid++; } else { console.log(`  âŒ ${driverDir} - INVALIDE`); invalid++; } } catch (error) { console.log(`  âŒ ${driverDir} - Erreur: ${error.message}`); invalid++; } } return { valid, invalid }; } try { const { valid, invalid } = validateWithHomey(); console.log(`\nğŸ‰ VALIDATION HOMEY TERMINÃ‰E !`); console.log(`âœ… Drivers valides: ${valid}`); console.log(`âŒ Drivers invalides: ${invalid}`); console.log(`ğŸ“Š Total: ${valid + invalid}`); console.log("::END::HOMEY_VALIDATE::OK"); process.exit(0); } catch (error) { console.error("ğŸ’¥ Erreur fatale:", error); console.log("::END::HOMEY_VALIDATE::FAIL"); process.exit(1); }
