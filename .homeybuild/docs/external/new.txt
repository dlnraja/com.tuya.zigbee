# GÃ©nÃ©ration d'un fichier texte contenant le bloc complet formatÃ©
bloc_complet = """
# ğŸš€ INSTRUCTION CURSOR â€” PROJET COMPLET `com.tuya.zigbee` (TUYA & ZIGBEE) ğŸ”

Tu dois reconstruire, stabiliser, enrichir et maintenir le projet GitHub `com.tuya.zigbee` (et sa variante `tuya-light`) Ã  lâ€™aide de tous les scripts, logs, discussions forum, archives, documents et drivers, en appliquant les rÃ¨gles de structuration suivantes :

---

## ğŸ“ STRUCTURE DOSSIER Ã€ RESPECTER (OBLIGATOIRE)

/drivers/tuya/        â†’ tous les drivers Tuya Zigbee uniquement  
/drivers/zigbee/      â†’ tous les autres drivers Zigbee non-Tuya  
/scripts/*.js         â†’ tous les scripts Node.js (scraping, IA, CI, validation)  
/scripts/*.ps1        â†’ tous les scripts PowerShell (synchros, backups, conversions)  
/data/*.json          â†’ fichiers IA locale (clusters, DPs, modÃ¨les, fallback)  
/docs/                â†’ documentation technique, changelog, PDF, specs  
.github/workflows/    â†’ GitHub Actions pour validation & automation  
README.md             â†’ README multilingue gÃ©nÃ©rÃ© (EN, FR, NL, TA)  
CHANGELOG.md          â†’ changelog enrichi automatiquement  
drivers-matrix.md     â†’ matrice dÃ©taillÃ©e des devices compatibles  
mega-pipeline.js      â†’ script principal autonome dâ€™orchestration  
app.json / app.js     â†’ requis pour chaque version (lite & full)

Supprimer tout dossier ou fichier obsolÃ¨te comme `/fusion*`, `/drivers/test-*`, `/old`, `/temp`, `/backup`, ou tout fichier `.DS_Store`, `.zip`, `.log` inutile.

---

## ğŸ¯ CONTRAINTES & OBJECTIFS MAJEURS

- SDK **obligatoirement â‰¥ 3**
- Fonctionnement 100â€¯% compatible avec Homey **Pro / Cloud / Bridge**
- Aucune publication automatique sur le store Homey (no `homey app publish`)
- ZÃ©ro perte de devices dÃ©jÃ  supportÃ©s ou historiques
- SystÃ¨me dâ€™auto-rÃ©paration et enrichissement permanent
- RÃ©silience : continue mÃªme sans OpenAI, GitHub token, ou accÃ¨s Internet
- Tous les scripts `.ps1` doivent Ãªtre convertis ou synchronisÃ©s avec les `.js`
- Enrichissement IA mÃªme partiel ou local est autorisÃ©
- Ne traiter **que** les sujets en rapport avec Zigbee et/ou Tuya

---

## ğŸ§  ENRICHISSEMENT IA LOCAL â€” `smart-enrich-drivers.js`

Utilise :

- `/data/tuya-inference-db.json` â†’ mapping `modelId` â†’ `capabilities`
- `/data/dps-map.json`, `/cluster-map.json`, `/z2m-compatibility.json`
- RÃ¨gles internes :
  - TS0003 â†’ 3x `onoff`
  - TS0601 + DP1 â†’ `onoff`
  - TS011F â†’ `onoff` + `meter_power`
- SystÃ¨me de fallback :
  "capabilities": ["onoff"],
  "fallback": true,
  "warning": "inferred with low confidence"

---

## ğŸ” PIPELINE GLOBALE â€” `mega-pipeline.js`

1. `ensureRequiredFilesExist()` â†’ crÃ©e README.md, app.js, specs manquants
2. `cleanObsoleteFiles()` â†’ supprime fusion*, orphelins, vieux dossiers
3. `fixAppStructure()` â†’ vÃ©rifie et corrige structure SDK3+, fichiers clÃ©s
4. `verifyAllDrivers()` â†’ JSON, champs, cross-validation app.json
5. `fetchNewDevices()` â†’ dÃ©tecte tout nouveau device Tuya ou Zigbee gÃ©nÃ©rique
6. `smart-enrich-drivers.js` â†’ enrichit drivers via IA locale ou OpenAI si dispo
7. `scrapeHomeyCommunity()` â†’ scrape automatiquement les discussions Homey :
   - https://community.homey.app/t/app-pro-tuya-zigbee-app/26439
   - https://community.homey.app/t/app-pro-universal-tuya-zigbee-device-app-lite-version/140352
   - + Z2M, Home Assistant, domotique-fr, GitHub
8. `fix-from-forum-feedback()` â†’ applique correctifs aux drivers impactÃ©s
9. `resolveTodoDevices()` â†’ transforme les `todo-*` en vrais drivers SDK3+
10. `fetchGitHubIssues()` â†’ rÃ©cupÃ¨re issues/PR si GITHUB_TOKEN dispo
11. `test-multi-firmware-compatibility()` â†’ test sur firmware Tuya & box Homey
12. `generate-docs()` â†’ gÃ©nÃ¨re README.md, CHANGELOG.md, drivers-matrix.md

---

## ğŸŒ SCRAPING & SYNCHRO SCRIPTÃ‰E

- Lire tout le contenu des scripts `.js` et `.ps1` pour amÃ©liorer la logique globale
- Indexer les bons patterns Ã  enrichir, tester, complÃ©ter ou automatiser
- Scraper forums Homey, GitHub, Tuya, Z2M, HA, domotique
- Enregistrer les rÃ©sultats dans `.cache/forum-capability-map.json`
- Chercher en prioritÃ© dans tous les messages pertinents des topics ci-dessus
- Scanner tout ce qui est script ou automation dans le projet pour amÃ©liorer la logique dâ€™exÃ©cution (`mega-pipeline.js` doit piloter tout le reste en fallback/resilient)

---

## ğŸ“š SOURCES & FICHIERS INTERNES IMPORTANTS

- Repo : https://github.com/dlnraja/com.tuya.zigbee
- Discussions & bugs forums :
  - https://community.homey.app/t/app-pro-tuya-zigbee-app/26439
  - https://community.homey.app/t/app-pro-universal-tuya-zigbee-device-app-lite-version/140352/33
- GitHub Actions : https://github.com/marketplace/actions/homey-app-validate
- Dev Portal Homey : https://apps.developer.homey.app
- Koenkk Z2M : https://github.com/Koenkk/zigbee-herdsman-converters
- Docs locales :
  - `/docs/specs/*.md`
  - `ultime.txt`
  - `[APP][PRO]Universal TUYA Zigbee Device App - lite version.pdf`

âœ… Ce fichier est prÃªt pour Cursor.
"""

# Sauvegarde dans un fichier texte
output_path = "/mnt/data/instruction_cursor_com_tuya_zigbee.txt"
with open(output_path, "w", encoding="utf-8") as f:
    f.write(bloc_complet)

output_path
