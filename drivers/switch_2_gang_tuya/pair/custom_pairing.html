<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TS0002 Pairing</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    h1 {
      font-size: 24px;
      margin: 0 0 8px 0;
      color: #333;
    }
    
    .subtitle {
      color: #666;
      margin-bottom: 24px;
      font-size: 14px;
    }
    
    .device-info {
      background: #f9f9f9;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
    }
    
    .info-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .info-row:last-child {
      border-bottom: none;
    }
    
    .info-label {
      font-weight: 600;
      color: #666;
      font-size: 14px;
    }
    
    .info-value {
      color: #333;
      font-size: 14px;
      font-family: 'Monaco', 'Courier New', monospace;
    }
    
    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .status.success {
      background: #4CAF50;
      color: white;
    }
    
    .status.warning {
      background: #FF9800;
      color: white;
    }
    
    .status.error {
      background: #F44336;
      color: white;
    }
    
    .capabilities-list {
      list-style: none;
      padding: 0;
      margin: 12px 0;
    }
    
    .capabilities-list li {
      padding: 8px 12px;
      background: #e3f2fd;
      margin: 4px 0;
      border-radius: 6px;
      font-size: 14px;
      font-family: 'Monaco', 'Courier New', monospace;
    }
    
    .endpoints-list {
      display: flex;
      gap: 8px;
      margin: 12px 0;
    }
    
    .endpoint {
      background: #fff3e0;
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: 600;
      font-size: 14px;
    }
    
    .button {
      background: #2196F3;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      transition: background 0.2s;
    }
    
    .button:hover {
      background: #1976D2;
    }
    
    .button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .button.secondary {
      background: #757575;
    }
    
    .button.secondary:hover {
      background: #616161;
    }
    
    .driver-selector {
      margin: 20px 0;
    }
    
    .driver-option {
      background: #f5f5f5;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 16px;
      margin: 8px 0;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .driver-option:hover {
      border-color: #2196F3;
      background: #e3f2fd;
    }
    
    .driver-option.selected {
      border-color: #2196F3;
      background: #e3f2fd;
    }
    
    .driver-option h3 {
      margin: 0 0 8px 0;
      font-size: 16px;
      color: #333;
    }
    
    .driver-option p {
      margin: 0;
      font-size: 14px;
      color: #666;
    }
    
    .recommended-badge {
      display: inline-block;
      background: #4CAF50;
      color: white;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 8px;
    }
    
    .search-box {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 16px;
      box-sizing: border-box;
    }
    
    .search-box:focus {
      outline: none;
      border-color: #2196F3;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
    }
    
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #2196F3;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .log-container {
      background: #263238;
      color: #aed581;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 12px;
      padding: 16px;
      border-radius: 8px;
      max-height: 200px;
      overflow-y: auto;
      margin: 20px 0;
    }
    
    .log-entry {
      margin: 4px 0;
      line-height: 1.4;
    }
    
    .log-entry.success { color: #4CAF50; }
    .log-entry.error { color: #F44336; }
    .log-entry.warning { color: #FF9800; }
    .log-entry.info { color: #2196F3; }
  </style>
</head>
<body>
  <div class="container">
    <div id="loading-view" class="loading">
      <div class="spinner"></div>
      <p>DÃ©couverte du dispositif...</p>
    </div>
    
    <div id="device-view" style="display: none;">
      <h1>ðŸ”Œ Dispositif 2-Gang DÃ©tectÃ©</h1>
      <p class="subtitle">VÃ©rifiez les informations et sÃ©lectionnez le driver appropriÃ©</p>
      
      <div class="device-info">
        <div class="info-row">
          <span class="info-label">ModÃ¨le</span>
          <span class="info-value" id="model-id">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">Fabricant</span>
          <span class="info-value" id="manufacturer">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">Endpoints</span>
          <div class="endpoints-list" id="endpoints">
            <span class="endpoint">1</span>
            <span class="endpoint">2</span>
          </div>
        </div>
        <div class="info-row">
          <span class="info-label">DPs DÃ©couverts</span>
          <span class="info-value" id="dps-discovered">DP 1, DP 2</span>
        </div>
        <div class="info-row">
          <span class="info-label">Statut</span>
          <span class="status success" id="status">âœ“ PrÃªt</span>
        </div>
      </div>
      
      <h3>CapacitÃ©s DÃ©tectÃ©es</h3>
      <ul class="capabilities-list" id="capabilities">
        <li>onoff (Gang 1)</li>
        <li>onoff.gang2 (Gang 2)</li>
      </ul>
      
      <div class="driver-selector">
        <h3>SÃ©lectionnez le Driver</h3>
        <input type="text" class="search-box" id="driver-search" placeholder="Rechercher un driver...">
        
        <div class="driver-option selected" data-driver="switch_2_gang_tuya">
          <h3>2-Gang Switch/Outlet (Tuya DP) <span class="recommended-badge">RECOMMANDÃ‰</span></h3>
          <p>Pour les interrupteurs/prises 2-gangs utilisant le protocole Tuya DP</p>
        </div>
        
        <div class="driver-option" data-driver="switch_2_gang">
          <h3>2-Gang Switch (Standard Zigbee)</h3>
          <p>Pour les interrupteurs 2-gangs utilisant OnOff cluster standard</p>
        </div>
        
        <div class="driver-option" data-driver="outlet_2_gang">
          <h3>2-Gang Outlet</h3>
          <p>Pour les prises murales 2-gangs avec mesure de puissance</p>
        </div>
      </div>
      
      <h3>Logs de Diagnostic</h3>
      <div class="log-container" id="logs">
        <div class="log-entry success">âœ“ Device discovered successfully</div>
        <div class="log-entry info">â†’ Checking endpoints...</div>
        <div class="log-entry success">âœ“ Endpoint 1 found: OnOff cluster</div>
        <div class="log-entry success">âœ“ Endpoint 2 found: OnOff cluster</div>
        <div class="log-entry info">â†’ Checking Tuya DP support...</div>
        <div class="log-entry success">âœ“ Tuya cluster 0xEF00 found on endpoint 242</div>
        <div class="log-entry success">âœ“ DP 1, DP 2 discovered</div>
        <div class="log-entry success">âœ“ Recommended driver: switch_2_gang_tuya</div>
      </div>
      
      <button class="button" id="continue-btn">Continuer avec Driver SÃ©lectionnÃ©</button>
    </div>
  </div>
  
  <script>
    // Simulated pairing flow
    setTimeout(() => {
      document.getElementById('loading-view').style.display = 'none';
      document.getElementById('device-view').style.display = 'block';
    }, 2000);
    
    // Driver selection
    document.querySelectorAll('.driver-option').forEach(option => {
      option.addEventListener('click', () => {
        document.querySelectorAll('.driver-option').forEach(opt => {
          opt.classList.remove('selected');
        });
        option.classList.add('selected');
      });
    });
    
    // Continue button
    document.getElementById('continue-btn').addEventListener('click', () => {
      const selectedDriver = document.querySelector('.driver-option.selected').dataset.driver;
      addLog('info', `â†’ Driver sÃ©lectionnÃ©: ${selectedDriver}`);
      addLog('success', 'âœ“ Configuration du dispositif...');
      
      // Send to Homey
      if (window.Homey) {
        window.Homey.emit('continue', { driver: selectedDriver });
      }
      
      setTimeout(() => {
        addLog('success', 'âœ“ Dispositif configurÃ© avec succÃ¨s!');
        document.getElementById('continue-btn').textContent = 'âœ“ TerminÃ©';
        document.getElementById('continue-btn').disabled = true;
      }, 1000);
    });
    
    // Search functionality
    document.getElementById('driver-search').addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase();
      document.querySelectorAll('.driver-option').forEach(option => {
        const text = option.textContent.toLowerCase();
        option.style.display = text.includes(query) ? 'block' : 'none';
      });
    });
    
    // Log helper
    function addLog(type, message) {
      const logContainer = document.getElementById('logs');
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.textContent = message;
      logContainer.appendChild(entry);
      logContainer.scrollTop = logContainer.scrollHeight;
    }
  </script>
</body>
</html>
