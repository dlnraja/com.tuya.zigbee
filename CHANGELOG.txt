================================================================================
UNIVERSAL TUYA ZIGBEE - CHANGELOG
================================================================================

Format: Keep a Changelog (https://keepachangelog.com)
Versioning: Semantic Versioning (https://semver.org)

================================================================================
[2.15.93] - 2025-10-15 ðŸš¨ CRITICAL FIX
================================================================================

CRITICAL BUG FIX - Motion Sensors & SOS Buttons Now Work!
----------------------------------------------------------
**ISSUE**: Multiple users reported motion sensors and SOS buttons not triggering flows
**ROOT CAUSE**: IEEE address Buffer handling caused `v.replace is not a function` error
**IMPACT**: IAS Zone enrollment failed silently, preventing device notifications

FIXED
-----
âœ… Motion sensors now trigger flows correctly
âœ… SOS buttons now trigger alarm flows
âœ… IAS Zone enrollment works on first pairing
âœ… Proper Buffer-to-string conversion for IEEE addresses
âœ… Enhanced type safety checks

AFFECTED DRIVERS FIXED
----------------------
- drivers/motion_temp_humidity_illumination_multi_battery/device.js
- drivers/sos_emergency_button_cr2032/device.js

TECHNICAL DETAILS
-----------------
- zclNode._node.bridgeId returns Buffer, not string
- Added Buffer.isBuffer() check before processing
- Proper hex conversion: Array.from(buffer).map().join(':')
- Type verification before calling .replace()

COMMUNITY REPORTS ADDRESSED
---------------------------
- Diagnostic cad613e7 (v2.15.87): "Still no Motion and SOS triggered data"
- Diagnostic c411abc2 (v2.15.89): "SOS button not Triggering the alarm"
- Diagnostic c91cdb08 (v2.15.92): "doesn't see a button press on SOS button"

ADDED
-----
- New device support: _TZE284_vvmbj46n (TS0601 Color LCD Temp/Humidity Sensor)
  * Driver: temp_humid_sensor_advanced_battery
  * Community request by Karsten_Hille (GitHub #1175)
  * Uses Tuya cluster 0xEF00 with datapoints DP2, DP4, DP5

USER ACTION REQUIRED
--------------------
âš ï¸ IMPORTANT: Remove and re-pair motion sensors and SOS buttons after update
   - Old devices have corrupted IEEE addresses from previous bug
   - Fresh pairing ensures proper IAS Zone enrollment
   - Expected logs: "âœ… IAS CIE Address written successfully"

================================================================================
[2.1.51] - 2025-10-11
================================================================================

ADDED - GitHub Actions Integration
----------------------------------
- Official Homey GitHub Actions from athombv marketplace
  * athombv/github-action-homey-app-validate for validation
  * athombv/github-action-homey-app-update-version for versioning
  * athombv/github-action-homey-app-publish for publication

- Automated Publishing Workflow (homey-official-publish.yml)
  * Automatic validation on push to master
  * Semantic versioning (patch/minor/major)
  * Smart changelog generation from commits
  * Automatic version commit back to repository

- Continuous Validation Workflow (homey-validate.yml)
  * Multi-level validation (debug + publish)
  * JSON syntax checking
  * Driver structure verification
  * Runs on all PRs and development branches

- PowerShell Publication Script (publish-homey-official.ps1)
  * Local publication automation
  * Pre-flight checks
  * Cache cleaning
  * Dry-run mode support

DOCUMENTATION
-------------
- PUBLICATION_GUIDE_OFFICIELLE.md (comprehensive)
- QUICK_START_PUBLICATION.md (5-minute setup)
- .github/workflows/OFFICIAL_WORKFLOWS_GUIDE.md
- RECAP_IMPLEMENTATION_OFFICIELLE.md
- references/github_actions_official.json
- Updated README.md with CI/CD pipeline information
- Created CONTRIBUTING.md with complete guidelines
- Created LICENSE (MIT with attribution)
- Created README.txt for quick reference
- Created CHANGELOG.txt for text format

CHANGED
-------
- Updated version badge to 2.1.51
- Updated project structure documentation
- Enhanced development section with publication methods
- Fixed homey-validate.yml workflow validation issue

================================================================================
[2.1.40] - 2025-10-11
================================================================================

FIXED - Critical Community Bug Fixes
-------------------------------------
- Temperature/humidity sensors display values correctly (Bug #259)
- PIR motion sensors pair without "Unknown Device" conflicts (Bug #256)
- Version mismatch between app.json and package.json
- Restored missing driver.js files for 5 drivers

ADDED
-----
- Gas sensor TS0601_gas_sensor_2 support (Bug #261)
- Ultimate diagnostic and repair script

CHANGED
-------
- Cleaned overlapping manufacturer IDs across drivers
- Enhanced Zigbee cluster configurations

FORUM COMMUNITY FIXES DETAILS
------------------------------
Bug #259 - Temperature/Humidity Sensor (@Karsten_Hille)
  * Fixed temperature and humidity values display
  * Removed incorrect motion sensor detection
  * Cleaned alarm_motion and measure_luminance capabilities
  * Optimized manufacturer IDs by device type
  * Enhanced attribute reporting configuration
  * Corrected Zigbee clusters to 1026 and 1029

Bug #256 - PIR/Buttons "Unknown Device" (@Cam)
  * Fixed PIR sensors pairing correctly
  * Removed overlapping manufacturer IDs
  * Separated motion sensor IDs from temperature IDs
  * Optimized product IDs to TS0202 only
  * Improved device recognition

Bug #261 - Gas Sensor Support (@ugrbnk)
  * Added TS0601_gas_sensor_2 variants support
  * Enriched 5 new manufacturer IDs:
    - _TZE200_ezqy5pvh
    - _TZE204_ezqy5pvh
    - _TZE200_ggev5fsl
    - _TZE204_ggev5fsl
    - _TZE284_rjgdhqqi

================================================================================
[2.1.36] - 2025-10-09
================================================================================

ADDED
-----
- 1,767 Flow Cards (661 triggers, 698 conditions, 408 actions)
- 2,481 Corrections in app.json sync
- Advanced Settings (calibration, reporting intervals, sensitivity)
- Maintenance Actions (identify device, reset meters)
- Energy.batteries configuration for all battery devices
- Complete coherence verification for 163 drivers

FIXED
-----
- Temperature/humidity/battery parsers (11 drivers)
- Missing manufacturer IDs (_TZE284_vvmbj46n and more)
- Missing product IDs sync (159 drivers)
- Flow handlers added to all drivers
- 0 validation errors - SDK3 compliant

================================================================================
[1.4.1] - 2025-10-07
================================================================================

ADDED
-----
- 36 new manufacturer IDs (+64% increase)
- Zigbee2MQTT database integration (34 IDs)
- Enki (Leroy Merlin) device support (4 devices)
- Forum community requested IDs (17 IDs)
- Deep scraping and analysis tools
- Comprehensive integration scripts
- Professional file organization

CHANGED
-------
- Optimized product IDs (removed 1,014 incompatible IDs)
- Improved device recognition accuracy
- Enhanced UNBRANDED categorization
- Updated all documentation to English

FIXED
-----
- Generic device detection issue
- Temperature sensor misclassification (Post #228)
- ProductId type mismatches (110 drivers cleaned)
- File organization and structure

COVERAGE
--------
- Total devices: ~1,200+ (was ~800)
- Manufacturer IDs: 110 (was 67)
- Coverage increase: +50%

================================================================================
COMPATIBILITY
================================================================================

- Homey Pro: Full support
- Homey Cloud: Verified developer required
- SDK: v3 (latest)
- Node.js: 18+
- Compatibility: >=12.2.0

================================================================================
MIGRATION FROM ZIGBEE2MQTT
================================================================================

1. Remove device from Zigbee2MQTT
2. Factory reset the device
3. Add to Homey using this app
4. Device automatically recognized

Same manufacturer IDs = Seamless migration

================================================================================
SUPPORT
================================================================================

GitHub Issues:
https://github.com/dlnraja/com.tuya.zigbee/issues

Homey Forum:
https://community.homey.app/t/140352/

Documentation:
See all .md files in project root

================================================================================
LICENSE
================================================================================

MIT License - Copyright (c) 2025 Dylan Rajasekaram
Based on Johan Bendz's work (MIT License)

See LICENSE file for complete details.

================================================================================
END OF CHANGELOG
================================================================================
