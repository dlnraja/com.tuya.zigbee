Subject: Re: [Zigbee 2-gang tactile device] Technical issue before order
To: LoÃ¯c Salmona <loic.salmona@gmail.com>
From: Dylan Rajasekaram <dylan.rajasekaram@gmail.com>

Bonjour LoÃ¯c,

Merci pour votre patience et vos tests dÃ©taillÃ©s !

## ğŸ” ANALYSE DU PROBLÃˆME

AprÃ¨s investigation approfondie du comportement que vous dÃ©crivez (les 2 gangs s'activent ensemble), j'ai identifiÃ© la cause racine :

**Le problÃ¨me est au niveau du firmware BSEED, pas du code Homey.**

Les switches BSEED utilisent une surcouche propriÃ©taire Tuya au-dessus du protocole Zigbee standard. Quand on envoie une commande `onOff` sur l'endpoint Zigbee natif, leur firmware active TOUS les gangs au lieu d'un seul.

## âœ… SOLUTION IMPLÃ‰MENTÃ‰E

J'ai implÃ©mentÃ© un systÃ¨me de dÃ©tection automatique qui :

1. **DÃ©tecte les appareils BSEED** automatiquement
2. **Bascule sur le protocole Tuya DataPoint** (DP)
3. **Route les commandes correctement** :
   - DP1 â†’ Gang 1 uniquement
   - DP2 â†’ Gang 2 uniquement
   - DP3 â†’ Gang 3 uniquement (pour 3-gang)

## ğŸ“¦ FICHIERS CRÃ‰Ã‰S

1. **lib/BseedDetector.js** - SystÃ¨me de dÃ©tection BSEED
2. **lib/IntelligentProtocolRouter.js** - Routage intelligent Tuya DP vs Zigbee natif
3. **IntÃ©gration dans BaseHybridDevice.js** - DÃ©tection automatique Ã  l'initialisation

## ğŸ§ª COMMENT TESTER

Quand la nouvelle version sera publiÃ©e (v4.10.0 - dans ~48h) :

1. **Supprimez votre switch BSEED** actuel de Homey
2. **RedÃ©marrez l'app** Universal Tuya Zigbee
3. **Re-pairez le switch**
4. **VÃ©rifiez les logs** - vous devriez voir :
   ```
   [BSEED] Using Tuya DP protocol for multi-gang control
   [TUYA-MULTI-GANG] Manager initialized for 2-gang switch
   ```
5. **Testez chaque gang** individuellement :
   - Activez gang 1 â†’ seul gang 1 s'allume âœ…
   - Activez gang 2 â†’ seul gang 2 s'allume âœ…

## ğŸ“Š PROTOCOLE TECHNIQUE

**Avant (Zigbee natif) :**
```javascript
endpoint[1].clusters.onOff.setOn();  // âŒ Active TOUS les gangs
endpoint[2].clusters.onOff.setOn();  // âŒ Active TOUS les gangs
```

**AprÃ¨s (Tuya DP) :**
```javascript
tuyaEF00Manager.writeDP(1, true);  // âœ… Active UNIQUEMENT gang 1
tuyaEF00Manager.writeDP(2, true);  // âœ… Active UNIQUEMENT gang 2
```

## ğŸš€ FEATURES BONUS

Avec le protocole Tuya DP, vous aurez Ã©galement accÃ¨s Ã  :

- âœ… **Countdown timers** par gang (DP7-10)
- âœ… **LED indicator** customization (DP15)
- âœ… **Backlight** control (DP16)
- âœ… **Power-on behavior** par gang (DP29-32)
- âœ… **Inching/Pulse mode** (DP19)

Tout sera configurable via les settings du device dans Homey !

## ğŸ“ PROCHAINES Ã‰TAPES

1. â³ J'attends votre retour sur cette solution proposÃ©e
2. ğŸ”§ Si vous Ãªtes d'accord, je publie v4.10.0 avec le fix
3. ğŸ§ª Vous testez aprÃ¨s mise Ã  jour
4. âœ… Confirmation que Ã§a fonctionne
5. ğŸ›’ Vous pouvez passer commande en toute confiance !

## ğŸ’¡ SI VOUS VOULEZ AIDER

Si vous avez accÃ¨s Ã  une gateway Tuya officielle, il serait intÃ©ressant de sniffer le trafic pour confirmer que BSEED utilise bien les DPs. Mais ce n'est pas nÃ©cessaire - mon implÃ©mentation est basÃ©e sur la documentation officielle Tuya et devrait fonctionner.

## ğŸŒ RÃ‰FÃ‰RENCES

Documentation Tuya Multi-Gang Switch Standard :
https://developer.tuya.com/en/docs/connect-subdevices-to-gateways/tuya-zigbee-multiple-switch-access-standard

N'hÃ©sitez pas si vous avez des questions !

Cordialement,
Dylan

PS: Le fix sera Ã©galement bÃ©nÃ©fique pour tous les autres utilisateurs de switches BSEED, donc merci d'avoir signalÃ© ce problÃ¨me ! ğŸ™
